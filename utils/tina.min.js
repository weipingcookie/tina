!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.tina=n()}(this,function(){"use strict";function t(t){var n={};return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).forEach(function(e){e in t&&(n[e]=t[e])}),n}function n(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.filter(function(t){return-1===n.indexOf(t)})}function e(t){return Object.keys(t).map(function(n){return t[n]})}function r(){var t={};return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(n){var e=O(n,2),r=e[0],o=e[1];return t[r]=o}),t}function o(t){var n=t.TargetClass,e=t.getSourceInstance;return t.properties.forEach(function(t){Object.defineProperty(n.prototype,t,{set:function(n){e(this)[t]=n},get:function(){var n=e(this),r=n[t];return"function"==typeof r?r.bind(n):r}})}),n}function i(t,n,e){var r=t.isData,o=t.fromPlainObject,i=t.merge;if(n=r(n)?n:o(n),"object"===(void 0===e?"undefined":h(e))){n=i(n,o(d(k(e,function(t,n){return"object"===(void 0===n?"undefined":h(n))&&void 0!==n.value}),function(t,n){return n.value})))}return n}function a(){this.setData(),this.$log("Initial Mixin","Ready")}function u(){this.$log=this.constructor.log.bind(this.constructor),this.$log("Log Mixin","Ready")}function c(t){return d(t||{},function(t,n){return function(){for(var n=this.__tina_instance__,e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];return n[t].apply(n,r)}})}function s(t,n){return r(t.map(function(t){var e=n(t);return[t,function(){var n=this.__tina_instance__;if(e&&n[e]&&n[e].apply(n,arguments),n[t])return n[t].apply(n,arguments)}]}))}function f(t,n,e){throw new Error('[Tina] - The method "'+t+'" of DataAdaptor should be overrided by a function, which receives arguments <('+n.join(", ")+")> and return <"+e+">.")}var l=Object.prototype.toString,p=function(t){var n;return"[object Object]"===l.call(t)&&(null===(n=Object.getPrototypeOf(t))||n===Object.getPrototypeOf({}))},d=function(t,n){for(var e={},r=Object.keys(t),o=r.length,i=0;i<o;i++){var a=r[i];e[a]=n(a,t[a])}return e},h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")},v=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),g=function(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t},m=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},b=function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)},_=function(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?t:n},O=function(){return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,n){var e=[],r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(e.push(a.value),!n||e.length!==n);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return e}(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),j=function(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);n<t.length;n++)e[n]=t[n];return e}return Array.from(t)},P={App:App,Page:Page,Component:Component,wx:wx,getApp:getApp,getCurrentPages:getCurrentPages},w=function(t,n){return Array.isArray(t)?t.concat(n):"object"===(void 0===t?"undefined":h(t))?m({},t,n):n},x=function(){function t(){y(this,t)}return v(t,[{key:"setData",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},e=this.adapters.data,r=e.isData,o=e.fromPlainObject,i=e.merge,a=e.diff,u=e.toPlainObject;t=r(t)?t:o(t);var c=i(this.data,t);if("function"==typeof this.compute){var s=this.compute(c);c=i(c,s=r(s)?s:o(s))}var f=u(a(c,this.data));if(p(f)||console.warn("[Tina] - The data which is passed to MINA should be a plain object, please check your DataAdaptor-class."),this.constructor.log("setData",f),this.data=c,function(t){if(null==t)return!0;if(t.length>0)return!1;if(0===t.length)return!0;for(var n in t)if(hasOwnProperty.call(t,n))return!1;return!0}(f))return n();this.$source.setData(f,n)}}],[{key:"mixin",value:function(t){this._mixins.push(t)}},{key:"mix",value:function(t,n){var e=this;if(Array.isArray(n))return n.reduce(function(t,n){return e.mix(t,n)},t);if("function"==typeof n)return this.mix(t,n(t,this));return m({},t,d(n,function(n,e){return w(t[n],e)}))}},{key:"log",value:function(t,n){this.debug&&console.log("[Tina."+this.name+"] - "+t+(n?": ":""),n)}}]),t}();x.debug=!1,x._mixins=[];var k=function(t,n){for(var e={},r=Object.keys(t),o=r.length,i=0;i<o;i++){var a=r[i];n(a,t[a])&&(e[a]=t[a])}return e},A=function(t,n){return function(t,n){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={},o=function(o){r[o]=function(){for(var r=arguments.length,i=Array(r),a=0;a<r;a++)i[a]=arguments[a];e&&n[o].apply(this,i),"function"==typeof t[o]&&t[o].apply(this,i),e||n[o].apply(this,i)}};for(var i in n)o(i);return m({},t,r)}(t,n,!0)},D={attached:a,onLoad:a},S={created:u,beforeLoad:u,onLaunch:u},T=["onLaunch","onShow","onHide","onError","onPageNotFound"],C=["onLaunch","onShow","onHide","onError","onPageNotFound"],E={},$=["mixins"],L=[].concat(C),R=[].concat(C,j(e(E))),I=m({mixins:[]},r(R.map(function(t){return[t,[]]}))),B=[S],M=function(e){function r(e){var o,i=e.options,a=void 0===i?{}:i;y(this,r);var u=_(this,(r.__proto__||Object.getPrototypeOf(r)).call(this)),c=m({},function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t(e,n(Object.keys(e),r))}(a,[].concat(T,$)),d(t(a,R),function(t,n){return function(){for(var t=this,e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];return n.reduce(function(n,e){return e.apply(t,r.concat(n))},void 0)}}));for(var s in c)u[s]=c[s];return o=u,_(u,o)}return b(r,x),v(r,null,[{key:"define",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=this.mix(I,[].concat(B,j(this._mixins),j(e.mixins||[]),[e]));var o=m({},s(C.filter(function(t){return e[t].length>0}),function(t){return E[t]}));o=A(o,{onLaunch:function(){var t=new r({options:e});this.__tina_instance__=t,t.$source=this}}),new P.App(m({},t(e,n(T,L)),o))}}]),v(r,[{key:"setData",value:function(){throw new Error("`setData` of Tina.App is not a function")}}]),r}();M._mixins=[],o({TargetClass:M,getSourceInstance:function(t){return t.$source},properties:[].concat(j(n([],[])),j(n([],[])))});var H=function(t,n){function e(t,a){a>n||"function"!=typeof t&&void 0!==t&&("object"!=typeof t||!t||t instanceof i?o+=t:-1===r.indexOf(t)&&a!==n&&(r.push(t),o+="{",Object.keys(t).forEach(function(n,r,i){if("_"!==n.charAt(0)){var u=typeof t[n];"function"!==u&&"undefined"!==u&&(o+=n,e(t[n],a+1))}})))}n=n||10;var r=[],o="",i=RegExp;return e(t,0),o},N=Object.prototype.hasOwnProperty,U=function(t,n,e){!function(t,n,e){for(var r in t)if(!1===n.call(e,t[r],r,t))break}(t,function(r,o){if(N.call(t,o))return n.call(e,t[o],o,t)})},F=function(){function t(){y(this,t)}return v(t,null,[{key:"isData",value:function(t){f("isData",["data"],"Boolean()")}},{key:"fromPlainObject",value:function(t){f("fromPlainObject",["plain"],"data")}},{key:"merge",value:function(t,n){f("merge",["original","extra"],"data")}},{key:"diff",value:function(t,n){f("diff",["original","extra"],"data")}},{key:"toPlainObject",value:function(t){f("diff",["data"],"plain")}}]),t}(),Q=function(){function t(n){var e=this;y(this,t),U(n,function(t,n){e[n]=t}),Object.defineProperty(this,"__signatures",{enumerable:!1,writable:!0}),this.sign()}return v(t,[{key:"sign",value:function(){this.__signatures=d(this,function(t,n){return H(n)})}},{key:"signature",value:function(t){return this.__signatures[t]}},{key:"isDirty",value:function(t){var n=this;return t?!(!this[t]&&!this.__signatures[t])&&this.__signatures[t]!==H(this[t]):Object.keys(this).some(function(t){return n.isDirty(t)})}}]),t}(),q=function(t){function n(){return y(this,n),_(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return b(n,F),v(n,null,[{key:"isData",value:function(t){return t instanceof Q}},{key:"fromPlainObject",value:function(t){return new Q(t)}},{key:"merge",value:function(t,n){return new Q(m({},t,n))}},{key:"diff",value:function(t,n){return new Q(k(t,function(e,r){return r!==n[e]||t.signature(e)!==n.signature(e)}))}},{key:"toPlainObject",value:function(t){return d(t,function(t,n){return n})}}]),n}(),z=["data","onLoad","onReady","onShow","onHide","onUnload","onPullDownRefresh","onReachBottom","onShareAppMessage","onPageScroll","onTabItemTap"],G=["onLoad","onReady","onShow","onHide","onUnload","onPullDownRefresh","onReachBottom","onShareAppMessage","onPageScroll","onTabItemTap"],J={onLoad:"beforeLoad"},K=["data"].concat(G),V=[].concat(G,j(e(J))),W=m({mixins:[],data:{},compute:function(){}},r(V.map(function(t){return[t,[]]})),{methods:{},adapters:{data:q}}),X=[S,D],Y=function(e){function r(n){var e,o=n.options,i=void 0===o?{}:o;n.$source;y(this,r);var a=_(this,(r.__proto__||Object.getPrototypeOf(r)).call(this)),u=m({data:i.data,compute:i.compute||function(){return{}}},i.methods,d(t(i,V),function(t,n){return function(){for(var t=this,e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];return n.reduce(function(n,e){return e.apply(t,r.concat(n))},void 0)}}),{adapters:i.adapters});for(var c in u)a[c]=u[c];return e=a,_(a,e)}return b(r,x),v(r,null,[{key:"define",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(e=this.mix(W,[].concat(X,j(this._mixins),j(e.mixins||[]),[e]))).data=i(e.adapters.data,e.data);var o=m({data:e.adapters.data.toPlainObject(e.data)},c(e.methods),s(G.filter(function(t){return e[t].length>0}),function(t){return J[t]}));o=A(o,{onLoad:function(){var t=new r({options:e,$source:this});this.__tina_instance__=t,t.$source=this}}),new P.Page(m({},t(e,n(z,K)),o))}}]),r}();Y._mixins=[],o({TargetClass:Y,getSourceInstance:function(t){return t.$source},properties:[].concat(j(n(["data","route"],["data"])),j(n(["setData"],["setData"])))});var Z=["properties","data","methods","behaviors","created","attached","ready","moved","detached","relations","externalClasses","options"],tt=["created","attached","ready","moved","detached"],nt={},et=["properties","data","methods"].concat(tt),rt=[].concat(tt,j(e(nt))),ot=m({mixins:[],behaviors:[],properties:{},data:{},compute:function(){}},r(rt.map(function(t){return[t,[]]})),{methods:{},relations:{},options:{},adapters:{data:q}}),it=[S,D],at=function(e){function r(n){var e,o=n.options,i=void 0===o?{}:o;n.$source;y(this,r);var a=_(this,(r.__proto__||Object.getPrototypeOf(r)).call(this)),u=m({data:i.data,compute:i.compute||function(){return{}}},i.methods,d(t(i,rt),function(t,n){return function(){for(var t=this,e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];return n.reduce(function(n,e){return e.apply(t,r.concat(n))},void 0)}}),{adapters:i.adapters});for(var c in u)a[c]=u[c];return e=a,_(a,e)}return b(r,x),v(r,null,[{key:"define",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(e=this.mix(ot,[].concat(it,j(this._mixins),j(e.mixins||[]),[e]))).data=i(e.adapters.data,e.data,e.properties);var o=m({data:e.adapters.data.toPlainObject(e.data),properties:function(t){function n(t,n){return function(){for(var e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];var i=r[0],a=this.__tina_instance__,u=this.__tina_instance__.adapters.data.fromPlainObject;return a.setData(u(g({},t,i))),"string"==typeof n?a[n].apply(a,r):"function"==typeof n?n.apply(a,r):void 0}}return d(t||{},function(t,e){return"function"==typeof e||null===e?{type:e,observer:n(t)}:"object"===(void 0===e?"undefined":h(e))?m({},e,{observer:n(t,e.observer)}):void 0})}(e.properties),methods:c(e.methods)},s(tt.filter(function(t){return e[t].length>0}),function(t){return nt[t]}));o=A(o,{created:function(){var t=new r({options:e,$source:this});this.__tina_instance__=t,t.$source=this}}),new P.Component(m({},t(e,n(Z,et)),o))}}]),r}();at._mixins=[],o({TargetClass:at,getSourceInstance:function(t){return t.$source},properties:[].concat(j(n(["is","id","dataset","data"],["data"])),j(n(["setData","hasBehavior","triggerEvent","createSelectorQuery","selectComponent","selectAllComponents","getRelationNodes","createIntersectionObserver"],["setData"])))});var ut=function(t){function n(){return y(this,n),_(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return b(n,F),v(n,null,[{key:"isData",value:function(t){return p(t)}},{key:"fromPlainObject",value:function(t){return t}},{key:"merge",value:function(t,n){return m({},t,n)}},{key:"diff",value:function(t,n){return k(t,function(t,e){return e!==n[t]})}},{key:"toPlainObject",value:function(t){return t}}]),n}(),ct=function(){function t(){y(this,t)}return v(t,null,[{key:"use",value:function(t){if(~this._plugins.indexOf(t))return this;if("function"==typeof t.install){for(var n=arguments.length,e=Array(n>1?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];t.install.apply(t,[this].concat(e))}return this._plugins.push(t),this}}]),t}();return ct.Unit=x,ct.App=M,ct.getApp=function(){return P.getApp().__tina_instance__},ct.Page=Y,ct.getCurrentPages=function(){return P.getCurrentPages().map(function(t){return t.__tina_instance__})},ct.Component=at,ct.BasicDataAdapter=F,ct.PlainDataAdapter=ut,ct.SigmundDataAdapter=q,ct.globals=P,ct._plugins=[],ct});